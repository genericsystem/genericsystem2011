<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:gs="http://java.sun.com/jsf/composite/gs">
	<h:outputStylesheet>
		.rf-ind-drag.default {
	        background-position: 5px;
	        background-repeat: no-repeat;
	        border: 2px solid red;
	        padding: 5px;
	        background-color: #EB9A99;
        }
        .rf-ind-drag.accept {
	        background-position: 5px;
	        background-repeat: no-repeat;
	        border: 2px solid green;
        }
        .rf-ind-drag.reject {
	        background-position: 5px;
	        background-repeat: no-repeat;
	        border: 2px solid red;
	    }
	</h:outputStylesheet>

	<rich:panel id="paneltypesmanager" layout="block"
		styleClass="widthScroll280 fullHeight">
		<f:facet name="header">
			<h:outputText value="#{msg.show} #{msg.implicits}"
				styleClass="capitalize bold" />
			<h:selectBooleanCheckbox value="#{genericTreeBean.implicitShow}"
				title="#{msg.show} #{msg.implicits}" style="vertical-align: middle;">
				<a4j:ajax event="change" execute="@this" render="typestree" />
			</h:selectBooleanCheckbox>
			<h:outputText value="#{msg.lockSelection}"
				styleClass="bold" />
			<h:selectBooleanCheckbox value="#{genericTreeBean.selectionLocked}"
				title="#{msg.lockSelection}" style="vertical-align: middle;">
				<a4j:ajax event="change" execute="typestree" render="typestree" />
			</h:selectBooleanCheckbox>
		</f:facet>

		<script type="text/javascript">
			function menuTypes() {
				var panelPosX = #{rich:element('paneltypesmanager')}.getBoundingClientRect().left + document.body.scrollLeft +document.documentElement.scrollLeft;
				var panelPosY = #{rich:element('paneltypesmanager')}.getBoundingClientRect().top + document.body.scrollTop +document.documentElement.scrollTop; 
			
				#{rich:element('menutypesmanager')}.getElementsByTagName("div")[0].getElementsByTagName("div")[0].style.left=(posx-panelPosX)+'px';
				#{rich:element('menutypesmanager')}.getElementsByTagName("div")[0].getElementsByTagName("div")[0].style.top=(posy-panelPosY)+'px';
			}
		</script>

		<rich:tree id="typestree" toggleType="ajax" var="item" status="status"
			selectionType="ajax"
			oncomplete="#{rich:component('menutypesmanager')}.hide();if(rightClick==true){#{rich:component('menutypesmanager')}.show();menuTypes();}"
			selectionChangeListener="#{genericTreeBean.change}"
			execute="typestree" render="paneltitletypesmanager,menutypesmanager,edittypesmanager">
			<rich:treeModelRecursiveAdaptor roots="#{genericTreeBean.root}"
				nodes="#{genericTreeBean.getChildrens(item)}">
				<rich:treeNode iconCollapsed="#{genericTreeBean.getTypeIcon(item)}"
					iconExpanded="#{genericTreeBean.getTypeIcon(item)}"
					onmousedown="if(event.button==2){rightClick = true;posSouris(event);}else{rightClick = false;}"
					title="#{genericTreeBean.getTypeIconTitle(item)}">
					<rich:dragSource type="genericTreeNode" dragValue="#{item}"/>
					<rich:inplaceInput value="#{wrapperBean.getGenericTreeNodeWrapper(item).value}"
						title="#{genericTreeBean.getTypeIconTitle(item)}" editEvent="dblclick"
						rendered="#{!item.isReadOnly}" activeClass="blackcolor"
						changedClass="blackcolor" styleClass="#{genericTreeBean.getStyle(item)}">
						<a4j:ajax event="change" execute="typestree" render="typesmanager" />
					</rich:inplaceInput>
					<h:outputText value="#{item.getValue}"
						title="#{genericTreeBean.getTypeIconTitle(item)}"
						rendered="#{item.isReadOnly}"
						styleClass="#{genericTreeBean.getStyle(item)}" />
				</rich:treeNode>
			</rich:treeModelRecursiveAdaptor>
		</rich:tree>

		<rich:panel id="attributestypesmanager" layout="block">
			<f:facet name="header">
				<h:outputText value="#{msg.attribute}" />
			</f:facet>
			<gs:dragAttribute type="primitive" key="int" />
			<gs:dragAttribute type="primitive" key="long" />
			<gs:dragAttribute type="primitive" key="float" />
			<gs:dragAttribute type="primitive" key="double" />
			<gs:dragAttribute type="primitive" key="string" />
			<gs:dragAttribute type="primitive" key="boolean" />
		</rich:panel>
	</rich:panel>

</ui:composition>
